-- Lock-Fps.lua (phiÃªn báº£n Ä‘Ã£ sá»­a lá»—i cÃº phÃ¡p vÃ  an toÃ n khi reload)
repeat task.wait() until game:IsLoaded()

-- ðŸ§¹ Dá»n sáº¡ch cÅ© (ngáº¯t connection, bÃ¡o thread dá»«ng)
pcall(function()
    if getgenv().fps_loop then
        getgenv().fps_loop:Disconnect()
        getgenv().fps_loop = nil
    end
    -- Ä‘áº·t cá» Ä‘á»ƒ thread cÅ© dá»«ng
    getgenv().fps_thread_stop = true
    -- Ä‘á»£i 0.05s Ä‘á»ƒ thread cÅ© thoÃ¡t vÃ²ng láº·p
    task.wait(0.06)
    if game.CoreGui:FindFirstChild("FPS_UI") then
        game.CoreGui.FPS_UI:Destroy()
    end
end)

-- âš™ï¸ Cáº¥u hÃ¬nh
local TARGET_FPS = 5 -- chá»‰nh á»Ÿ Ä‘Ã¢y
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")

-- ðŸ–¥ UI (tá»‘i giáº£n, chá»‰ hiá»ƒn thá»‹ FPS siÃªu to giá»¯a mÃ n hÃ¬nh)
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local Label = Instance.new("TextLabel")

ScreenGui.Name = "FPS_UI"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

-- ðŸ–¥ UI (chá»‰ hiá»ƒn thá»‹ chá»¯ FPS siÃªu to, khÃ´ng ná»n)
local ScreenGui = Instance.new("ScreenGui")
local Label = Instance.new("TextLabel")

ScreenGui.Name = "FPS_UI"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui

-- âš¡ Chá»¯ FPS siÃªu to, giá»¯a mÃ n hÃ¬nh
Label.Size = UDim2.new(0, 1000, 0, 400)
Label.Position = UDim2.new(0.5, -500, 0.5, -200)
Label.BackgroundTransparency = 1 -- trong suá»‘t hoÃ n toÃ n
Label.TextColor3 = Color3.fromRGB(255, 255, 255)
Label.Font = Enum.Font.Code
Label.TextScaled = false
Label.TextSize = 480
Label.Text = "FPS: 00"
Label.TextXAlignment = Enum.TextXAlignment.Center
Label.TextYAlignment = Enum.TextYAlignment.Center
Label.TextStrokeTransparency = 0.3
Label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
Label.Parent = ScreenGui

-- Hiá»ƒn thá»‹ táº¡m
task.spawn(function()
    Notice.Text = "Cáº­p nháº­t script má»›i nháº¥t âœ…"
    task.wait(2)
end)

-- âš™ï¸ Thá»­ setfpscap náº¿u executor há»— trá»£
if setfpscap then
    pcall(setfpscap, TARGET_FPS)
end

-- ðŸ“‰ Ã‰p cá»©ng FPS báº±ng delay giá»¯a frame
local targetDelay = 1 / TARGET_FPS
local lastTick = tick()
local fps = 0

-- Connect RenderStepped (lÆ°u connection Ä‘á»ƒ cÃ³ thá»ƒ Disconnect khi reload)
getgenv().fps_loop = RunService.RenderStepped:Connect(function(dt)
    fps = math.floor(1 / (dt > 0 and dt or 0.0001))
    local now = tick()
    local elapsed = now - lastTick
    if elapsed < targetDelay then
        task.wait(targetDelay - elapsed)
    end
    lastTick = tick()
end)

-- Cáº­p nháº­t text má»—i 0.5s
task.spawn(function()
    while task.wait(0.5) do
        Label.Text = "FPS: " .. tostring(fps)
    end
end)

-- ðŸ’¤ Thread giá»¯ setfpscap á»•n Ä‘á»‹nh, cÃ³ thá»ƒ dá»«ng báº±ng cá»
getgenv().fps_thread_stop = false
getgenv().fps_thread = task.spawn(function()
    while not getgenv().fps_thread_stop do
        if setfpscap then
            pcall(setfpscap, TARGET_FPS)
        end
        task.wait(5)
    end
end)
