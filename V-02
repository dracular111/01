local sources = {
    { name = "HOP", url = "https://raw.githubusercontent.com/dracular111/01/main/V-Hop-time-connect-02" },
    { name = "FPS", url = "https://raw.githubusercontent.com/dracular111/01/main/FPS-02" },
    { name = "RESET", url = "https://raw.githubusercontent.com/dracular111/01/main/V-Reset" },
}

local http = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

-- üßπ X√≥a UI c≈© n·∫øu c√≥
local oldGui = CoreGui:FindFirstChild("AutoUpdaterUI")
if oldGui then
    oldGui:Destroy()
end

-- ü™Ñ UI g·ªçn, trong su·ªët, kh√¥ng tr√πng
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "AutoUpdaterUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = CoreGui
--ScreenGui.DisplayOrder = 999999999 -- ‚úÖ UI lu√¥n n·ªïi tr√™n m·ªçi UI kh√°c

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 180, 0, (#sources * 20) + 35)
Frame.Position = UDim2.new(1, -190, 1, -Frame.Size.Y.Offset - 6)
Frame.BackgroundTransparency = 1
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui

-- üìê Layout
local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 3)
UIListLayout.FillDirection = Enum.FillDirection.Vertical
UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Top
UIListLayout.Parent = Frame

-- üè∑ Ti√™u ƒë·ªÅ (ch·ªâ c√≤n 1 d√≤ng)
local Title = Instance.new("TextLabel")
Title.Text = "üîÅ Auto Script Updater"
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 16
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, -8, 0, 20)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Position = UDim2.new(0, 4, 0, 0)
Title.Parent = Frame

-- üß© Log helper
local function log(label, text)
    label.Text = text
end

-- ‚öôÔ∏è Fetch script (ch·ªëng cache)
local function fetchCode(url)
    local success, result = pcall(function()
        return game:HttpGet(url .. "?nocache=" .. tick())
    end)
    if success then
        return result
    else
        return nil, result
    end
end

-- ‚öôÔ∏è Safe run
local function safeRun(code, scriptName)
    local f, err = loadstring(code)
    if not f then
        warn(string.format("[Loader:%s] L·ªói bi√™n d·ªãch: %s", scriptName, err))
        return false, err
    end
    local success, execErr = pcall(f)
    if not success then
        warn(string.format("[Loader:%s] L·ªói khi ch·∫°y: %s", scriptName, execErr))
        return false, execErr
    end
    return true
end

-- üß† Script data
local scripts = {}

for _, src in ipairs(sources) do
    local lbl = Instance.new("TextLabel")
    lbl.Font = Enum.Font.SourceSansBold
    lbl.TextSize = 16
    lbl.TextColor3 = Color3.fromRGB(255, 255, 255)
    lbl.BackgroundTransparency = 1
    lbl.Size = UDim2.new(1, -10, 0, 20)
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = Frame
    lbl.Text = string.format("%s: ƒêang t·∫£i...", src.name)

    scripts[src.name] = {
        url = src.url,
        label = lbl,
        lastCode = nil,
        backup = nil,
        lastUpdate = "Ch∆∞a c·∫≠p nh·∫≠t"
    }

    task.spawn(function()
        local code, err = fetchCode(src.url)
        if not code then
            log(lbl, src.name .. ": ‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c (" .. tostring(err) .. ")")
            return
        end
        scripts[src.name].lastCode = code
        local ok = safeRun(code, src.name)
        if ok then
            scripts[src.name].lastUpdate = os.date("%H:%M:%S")
            log(lbl, string.format("%s: ‚úÖ ƒê√£ ch·∫°y ‚Ä¢ %s", src.name, scripts[src.name].lastUpdate))
        else
            log(lbl, src.name .. ": ‚ö†Ô∏è L·ªói khi ch·∫°y")
        end
    end)
end

-- üîÅ Theo d√µi thay ƒë·ªïi
task.spawn(function()
    while task.wait(20) do
        for name, data in pairs(scripts) do
            task.wait(5)
            local newCode, err = fetchCode(data.url)
            if not newCode then
                log(data.label, name .. ": ‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c (" .. tostring(err) .. ")")
                continue
            end

            if newCode ~= data.lastCode then
                log(data.label, name .. ": ‚ôªÔ∏è Ph√°t hi·ªán thay ƒë·ªïi, reload...")
                data.backup = data.lastCode
                local ok = safeRun(newCode, name)
                if ok then
                    data.lastCode = newCode
                    data.lastUpdate = os.date("%H:%M:%S")
                    log(data.label, string.format("%s: ‚úÖ Reload th√†nh c√¥ng ‚Ä¢ %s", name, data.lastUpdate))
                else
                    log(data.label, name .. ": ‚ö†Ô∏è L·ªói b·∫£n m·ªõi, kh√¥i ph·ª•c b·∫£n c≈©")
                    safeRun(data.backup, name)
                end
            else
                log(data.label, string.format("%s: üïí ‚Ä¢ %s", name, data.lastUpdate))
            end
        end
    end
end)
