local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- ⚙️ Cấu hình
local chiThreshold = 300
local webhookUrl = "https://discord.com/api/webhooks/1399413705195655279/-cbC1wOWk3QEBdoUUdHf7YPbsCsgt1g0cEDr6BRslBVZ_sWCDwruUS4pQvZ6dEG_xmnw"
local waitTime = 600 -- kiểm tra mỗi 10 phút
local totalBought = 0

-- 📦 Remote
local buyRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("BuyZenSeedPack")
local openRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("OpenSeedPack")

-- 🔢 Lấy Chi hiện tại
local function getChi()
	local chiStat = player:FindFirstChild("Chi") or player:WaitForChild("Chi")
	return chiStat and chiStat.Value or 0
end

-- 🌐 Gửi webhook
local function sendWebhook(title, packName, plantName, chiLeft)
	local message = string.format(
		"✅ **%s**\n📦 Pack: `%s`\n🌱 Seed nhận: `%s`\n🧘 Chi còn lại: `%d`\n🕐 %s\n📊 Tổng đã mua: `%d`",
		title, packName, plantName or "Không xác định", chiLeft, os.date("%Y-%m-%d %H:%M:%S"), totalBought
	)

	local payload = {
		["username"] = "Zen Auto Bot",
		["content"] = message
	}

	pcall(function()
		HttpService:PostAsync(
			webhookUrl,
			HttpService:JSONEncode(payload),
			Enum.HttpContentType.ApplicationJson
		)
	end)
end

-- 🧪 Hàm mua và mở gói
local function tryBuyAndOpen()
	local chi = getChi()
	if chi > chiThreshold then
		print("[ZenAuto] Đủ Chi ("..chi.."), đang mua gói...")

		-- Mua gói
		buyRemote:FireServer("Chi")
		totalBought += 1

		wait(2)

		-- Mở gói (giả định pack luôn tên "Zen Seed Pack")
		local result = nil
		local success, err = pcall(function()
			result = openRemote:InvokeServer("Zen Seed Pack") -- trả về tên seed
		end)

		-- Lấy tên cây nhận được
		local seedName = result or "Không rõ"

		-- Gửi webhook
		sendWebhook("Đã mua & mở Zen Seed Pack", "Zen Seed Pack", seedName, getChi())
	else
		print("[ZenAuto] Không đủ Chi ("..chi..")")
	end
end

-- 🔁 Lặp
while true do
	pcall(tryBuyAndOpen)
	wait(waitTime)
end
