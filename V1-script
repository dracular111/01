-- üîÑ GitHub Auto-Reload Loader (multi-script + persistent update UI)

local scripts = {
    { name = "FPS.lua", url = "https://raw.githubusercontent.com/dracular111/01/main/FPS" },
    { name = "Gift-Gem.lua", url = "https://raw.githubusercontent.com/dracular111/01/main/Track" },
    { name = "Event.lua", url = "https://raw.githubusercontent.com/dracular111/01/main/Event" },
}

local reloadDelay = 30 -- Ki·ªÉm tra c·∫≠p nh·∫≠t (gi√¢y)
local httpDelay = 5    -- Delay gi·ªØa m·ªói script (gi√¢y)
local CoreGui = game:GetService("CoreGui")

-- üß± H√†m UI th√¥ng b√°o
local function showNotification(text)
    local existingGui = CoreGui:FindFirstChild("GitHubUpdateNotice")
    local Label

    if existingGui then
        Label = existingGui:FindFirstChild("NoticeLabel")
        if Label then
            Label.Text = text
            return
        end
    end

    local ScreenGui = Instance.new("ScreenGui")
    local TextLabel = Instance.new("TextLabel")
    ScreenGui.Name = "GitHubUpdateNotice"
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = CoreGui

    TextLabel.Name = "NoticeLabel"
    TextLabel.Size = UDim2.new(0, 600, 0, 60)
    TextLabel.Position = UDim2.new(1, -610, 1, -80)
    TextLabel.BackgroundTransparency = 0.3
    TextLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    TextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TextLabel.Font = Enum.Font.Code
    TextLabel.TextScaled = true
    TextLabel.Text = text
    TextLabel.TextXAlignment = Enum.TextXAlignment.Center
    TextLabel.TextStrokeTransparency = 0.5
    TextLabel.Parent = ScreenGui
end

-- ‚öôÔ∏è T·∫£i & ch·∫°y code
local function fetchAndRun(scriptInfo)
    local success, code = pcall(function()
        return game:HttpGet(scriptInfo.url)
    end)
    if not success or not code or code == "" then
        warn("[Loader] ‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c:", scriptInfo.name)
        return nil
    end

    local func, err = loadstring(code)
    if not func then
        warn("[Loader] ‚ö†Ô∏è L·ªói bi√™n d·ªãch:", scriptInfo.name, err)
        return nil
    end

    -- üßπ D·ªçn d·∫πp Event.lua
    if scriptInfo.name == "Event.lua" and type(getgenv) == "function" then
        for k, _ in pairs(getgenv()) do
            if tostring(k):match("^G") then
                getgenv()[k] = nil
            end
        end
        print("[Loader] üßπ Cleared old globals for Event.lua")
    end

    -- üß© Sandbox ri√™ng
    local env = setmetatable({}, { __index = getfenv() })
    setfenv(func, env)

    local ok, runtimeErr = pcall(func)
    if not ok then
        warn("[Loader] ‚ö†Ô∏è L·ªói khi ch·∫°y:", scriptInfo.name, runtimeErr)
    else
        print("[Loader] ‚úÖ Loaded:", scriptInfo.name)
        if scriptInfo.name == "Event.lua" then
            showNotification("üéÉ Event.lua reloaded successfully at " .. os.date("%H:%M:%S"))
        end
    end

    return code
end

-- üî• Ch·∫°y l·∫ßn ƒë·∫ßu
local lastCodes = {}
for _, scriptInfo in ipairs(scripts) do
    lastCodes[scriptInfo.name] = fetchAndRun(scriptInfo)
    task.wait(httpDelay) -- delay 5s m·ªói script
end

showNotification("‚úÖ All scripts loaded at " .. os.date("%H:%M:%S"))

-- üîÅ Ki·ªÉm tra c·∫≠p nh·∫≠t
task.spawn(function()
    while task.wait(reloadDelay) do
        for _, scriptInfo in ipairs(scripts) do
            local ok, newCode = pcall(function()
                return game:HttpGet(scriptInfo.url)
            end)
            if ok and newCode and newCode ~= lastCodes[scriptInfo.name] then
                lastCodes[scriptInfo.name] = newCode
                fetchAndRun(scriptInfo)
                showNotification("üîÑ Updated " .. scriptInfo.name .. " at " .. os.date("%H:%M:%S"))
            end
            task.wait(httpDelay)
        end
    end
end)
