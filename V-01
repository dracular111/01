-- üîÑ Multi-script GitHub Auto Reload (anti-duplicate version)
local scripts = {
    { name = "FPS.lua", url = "https://raw.githubusercontent.com/dracular111/01/main/FPS" },
    { name = "Gift-Gem.lua", url = "https://raw.githubusercontent.com/dracular111/01/main/Track" },
    { name = "Event.lua", url = "https://raw.githubusercontent.com/dracular111/01/main/Event" },
}

local reloadDelay = 30
local CoreGui = game:GetService("CoreGui")

-- üß± UI th√¥ng b√°o nh·ªè ·ªü g√≥c ph·∫£i
local function showNotification(text)
    local gui = CoreGui:FindFirstChild("GitHubUpdateNotice")
    if not gui then
        gui = Instance.new("ScreenGui", CoreGui)
        gui.Name = "GitHubUpdateNotice"
        gui.IgnoreGuiInset = true
        gui.ResetOnSpawn = false
        gui.Parent = CoreGui
    end

    local label = gui:FindFirstChild("NoticeLabel")
    if not label then
        label = Instance.new("TextLabel")
        label.Name = "NoticeLabel"
        label.Size = UDim2.new(0, 600, 0, 60)
        label.Position = UDim2.new(1, -610, 1, -80)
        label.BackgroundTransparency = 0.3
        label.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.Font = Enum.Font.Code
        label.TextScaled = true
        label.TextStrokeTransparency = 0.5
        label.Parent = gui
    end

    label.Text = text
end

-- ‚öôÔ∏è Tr·∫°ng th√°i script
local lastCodes = {}
local loading = {} -- ch·ªëng tr√πng l·∫∑p load

-- üß© Safe fetch + execute
local function fetchAndRun(scriptInfo)
    if loading[scriptInfo.name] then
        warn("[Loader] ‚ö†Ô∏è Skip duplicate load:", scriptInfo.name)
        return
    end
    loading[scriptInfo.name] = true

    local ok, code = pcall(function()
        return game:HttpGet(scriptInfo.url)
    end)

    if not ok or not code then
        warn("[Loader] ‚ùå Fetch failed:", scriptInfo.name)
        loading[scriptInfo.name] = false
        return
    end

    code = code:gsub("\r\n", "\n")

    -- üßπ G·ªçi cleanup n·∫øu c√≥ b·∫£n c≈© ƒëang ch·∫°y
    if getgenv()[scriptInfo.name .. "_CLEANUP"] then
        pcall(getgenv()[scriptInfo.name .. "_CLEANUP"])
        getgenv()[scriptInfo.name .. "_CLEANUP"] = nil
    end

    local func, err = loadstring(code)
    if not func then
        warn("[Loader] ‚ö†Ô∏è Compile error in", scriptInfo.name, ":", err)
        loading[scriptInfo.name] = false
        return
    end

    local ok2, execErr = pcall(func)
    if not ok2 then
        warn("[Loader] ‚ö†Ô∏è Runtime error:", scriptInfo.name, ":", execErr)
    else
        print("[Loader] ‚úÖ Loaded:", scriptInfo.name)
    end

    loading[scriptInfo.name] = false
    return code
end

-- üî• Initial run
for _, info in ipairs(scripts) do
    lastCodes[info.name] = fetchAndRun(info)
end
showNotification("‚úÖ Scripts loaded at " .. os.date("%H:%M:%S"))

-- üîÅ Ki·ªÉm tra c·∫≠p nh·∫≠t ƒë·ªãnh k·ª≥
task.spawn(function()
    while task.wait(reloadDelay) do
        for _, info in ipairs(scripts) do
            local ok, newCode = pcall(function()
                return game:HttpGet(info.url)
            end)
            if ok and newCode then
                newCode = newCode:gsub("\r\n", "\n")
                if newCode ~= lastCodes[info.name] then
                    lastCodes[info.name] = newCode
                    fetchAndRun(info)
                    showNotification("üîÑ Updated " .. info.name .. " at " .. os.date("%H:%M:%S"))
                end
            end
            task.wait(1.5) -- tr√°nh spam request
        end
    end
end)
