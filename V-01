-- üîÑ GitHub Auto-Reload Loader (5s Delay + Countdown UI)
-- Ch·ªâ reload khi script thay ƒë·ªïi, c√≥ ƒë·∫øm ng∆∞·ª£c gi·ªØa c√°c l·∫ßn t·∫£i

-- üìú Danh s√°ch script GitHub
local scripts = {
    { name = "FPS.lua",      url = "https://raw.githubusercontent.com/dracular111/01/main/FPS" },
    { name = "Event.lua",    url = "https://raw.githubusercontent.com/dracular111/01/main/Event" },
    { name = "Gift-Gem.lua", url = "https://raw.githubusercontent.com/dracular111/01/main/Track" },
    -- { name = "Gift-Gem.lua", url = "https://raw.githubusercontent.com/dracular111/01/main/Gift-Gem" },
    -- { name = "Farm.lua",     url = "https://raw.githubusercontent.com/dracular111/01/main/Farm" },
}

-- ‚öôÔ∏è C·∫•u h√¨nh
local reloadDelay = 30   -- ki·ªÉm tra l·∫°i sau m·ªói v√≤ng (gi√¢y)
local httpDelay = 5      -- delay gi·ªØa m·ªói script (gi√¢y)
local CoreGui = game:GetService("CoreGui")

------------------------------------------------------------
-- üß± UI g√≥c ph·∫£i d∆∞·ªõi
------------------------------------------------------------
local function showNotification(text)
    local existingGui = CoreGui:FindFirstChild("GitHubUpdateNotice")
    local label

    if existingGui then
        label = existingGui:FindFirstChild("NoticeLabel")
        if label then
            label.Text = text
            return label
        end
    end

    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "GitHubUpdateNotice"
    screenGui.IgnoreGuiInset = true
    screenGui.ResetOnSpawn = false
    screenGui.Parent = CoreGui

    local textLabel = Instance.new("TextLabel")
    textLabel.Name = "NoticeLabel"
    textLabel.Size = UDim2.new(0, 600, 0, 60)
    textLabel.Position = UDim2.new(1, -610, 1, -80)
    textLabel.BackgroundTransparency = 0.3
    textLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.Font = Enum.Font.Code
    textLabel.TextScaled = true
    textLabel.TextXAlignment = Enum.TextXAlignment.Center
    textLabel.TextStrokeTransparency = 0.5
    textLabel.Text = text
    textLabel.Parent = screenGui

    return textLabel
end

------------------------------------------------------------
-- ‚öôÔ∏è T·∫£i & th·ª±c thi code an to√†n
------------------------------------------------------------
local function fetchAndRun(scriptInfo)
    local success, code = pcall(function()
        return game:HttpGet(scriptInfo.url)
    end)

    if not success then
        warn("[Loader] ‚ùå Kh√¥ng th·ªÉ t·∫£i:", scriptInfo.name)
        return nil
    end

    local func, err = loadstring(code)
    if not func then
        warn("[Loader] ‚ö†Ô∏è L·ªói bi√™n d·ªãch:", scriptInfo.name, err)
        return nil
    end

    local ok, execErr = pcall(func)
    if not ok then
        warn("[Loader] ‚ö†Ô∏è L·ªói khi ch·∫°y:", scriptInfo.name, execErr)
    else
        print("[Loader] ‚úÖ Loaded:", scriptInfo.name)
    end

    return code
end

------------------------------------------------------------
-- ‚è≥ Countdown hi·ªÉn th·ªã tr√™n UI
------------------------------------------------------------
local function countdownUI(label, seconds)
    for i = seconds, 1, -1 do
        label.Text = string.format("üïí Next script in %ds...", i)
        task.wait(1)
    end
end

------------------------------------------------------------
-- üöÄ L·∫ßn ch·∫°y ƒë·∫ßu ti√™n
------------------------------------------------------------
local label = showNotification("üöÄ Initializing scripts...")
local lastCodes = {}

for _, scriptInfo in ipairs(scripts) do
    local code = fetchAndRun(scriptInfo)
    lastCodes[scriptInfo.name] = code

    countdownUI(label, httpDelay)
end

label.Text = "‚úÖ All scripts loaded at " .. os.date("%H:%M:%S")

------------------------------------------------------------
-- üîÅ Ki·ªÉm tra & reload khi c√≥ thay ƒë·ªïi
------------------------------------------------------------
task.spawn(function()
    while true do
        print("\n[Loader] üîç Checking for updates at " .. os.date("%H:%M:%S"))

        for _, scriptInfo in ipairs(scripts) do
            local ok, newCode = pcall(function()
                return game:HttpGet(scriptInfo.url)
            end)

            if ok and newCode then
                if newCode ~= lastCodes[scriptInfo.name] then
                    print("[Loader] üîÑ Update detected:", scriptInfo.name)
                    lastCodes[scriptInfo.name] = newCode
                    fetchAndRun(scriptInfo)
                    label.Text = "üîÑ Updated " .. scriptInfo.name .. " at " .. os.date("%H:%M:%S")
                else
                    print("[Loader] ‚è© No change:", scriptInfo.name)
                    label.Text = "‚è© No change: " .. scriptInfo.name
                end
            else
                warn("[Loader] ‚ö†Ô∏è Failed to check:", scriptInfo.name)
                label.Text = "‚ö†Ô∏è Error fetching " .. scriptInfo.name
            end

            countdownUI(label, httpDelay)
        end

        label.Text = "‚è≥ Next full check in " .. reloadDelay .. "s..."
        task.wait(reloadDelay)
    end
end)
