 local plrs = game:GetService("Players")
local plr = plrs.LocalPlayer
local tpService = game:GetService("TeleportService")
local getPlayers = plrs:GetPlayers()
local PlayerInServer = #getPlayers
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local placeId = game.PlaceId
local currentJobId = game.JobId
local uis = game:GetService("UserInputService")
local vim = game:GetService("VirtualInputManager")
local runService = game:GetService("RunService")

-- Chá»n API ngáº«u nhiÃªn giá»¯a Asc vÃ  Desc
local function getRandomAPI()
	local sortOrder = (math.random(1, 2) == 1) and "Asc" or "Desc"
	return string.format(
		"https://games.roblox.com/v1/games/%s/servers/Public?sortOrder=%s&limit=100&excludeFullGames=true",
		placeId,
		sortOrder
	)
end
 
-- HÃ m láº¥y danh sÃ¡ch server há»£p lá»‡ (cÃ³ slot trá»‘ng)
local function getValidServers()
	local servers
	local attempts = 0
	repeat
		task.wait(5)
		local url = getRandomAPI()
 
		local success, response = pcall(function()
			return HttpService:JSONDecode(game:HttpGet(url)).data
		end)
 
		if success and response and #response > 0 then
			servers = {}
			for _, server in pairs(response) do
				if server.playing < server.maxPlayers and server.id ~= currentJobId then
					table.insert(servers, server)
				end
			end
			print("âœ… Sá»‘ lÆ°á»£ng server há»£p lá»‡:", #servers)
		else
			warn("âš ï¸ KhÃ´ng láº¥y Ä‘Æ°á»£c danh sÃ¡ch server! Thá»­ láº¡i...")
		end
 
		attempts += 1
	until (servers and #servers > 0) or attempts >= 5
 
	return servers
end
 
-- HÃ m rejoin náº¿u khÃ´ng tÃ¬m Ä‘Æ°á»£c server
local function rejoinServer()
	TeleportService:Teleport(placeId, player)
end
 
-- Retry flag Ä‘á»ƒ trÃ¡nh spam
local retrying = false
 
-- Tá»± Ä‘á»™ng thá»­ láº¡i náº¿u teleport tháº¥t báº¡i
TeleportService.TeleportInitFailed:Connect(function(failedPlayer, teleportResult, errorMessage)
	if failedPlayer == player and not retrying then
		retrying = true
		warn("âš ï¸ Teleport tháº¥t báº¡i:", teleportResult, "-", errorMessage)
		task.wait(3)
		print("ğŸ” Äang thá»­ láº¡i teleport...")
		serverHop()
		retrying = false
	end
end)
 
-- HÃ m nháº£y sang server khÃ¡c
function serverHop()
	local servers = getValidServers()
	if not servers or #servers == 0 then
		warn("âŒ KhÃ´ng tÃ¬m tháº¥y server nÃ o cÃ³ chá»— trá»‘ng sau nhiá»u láº§n thá»­!")
		rejoinServer()
		return
	end
 
	local newServer = servers[math.random(1, #servers)]
	print("ğŸ”„ Äang chuyá»ƒn sang server:", newServer.id)
	TeleportService:TeleportToPlaceInstance(placeId, newServer.id, player)
end

local usernames = {
"conmeohpz001",
}

local function getRandomUsername()
    local index = math.random(1, #usernames)
    return usernames[index]
end
