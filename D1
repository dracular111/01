if _G.CPULOW_AUTO then return end
_G.CPULOW_AUTO = true

local Lighting = game:GetService("Lighting")
local MaterialService = game:GetService("MaterialService")
local Terrain = workspace:FindFirstChildOfClass("Terrain")
local US = UserSettings():GetService("UserGameSettings")

-- Giảm cơ bản (cả 2 chế độ đều dùng)
local function BasicSettings()
	US.MasterVolume = 0
	US.GraphicsQualityLevel = 1
	settings().Rendering.QualityLevel = 1
	settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Level04
	MaterialService.Use2022Materials = false

	Lighting.GlobalShadows = false
	Lighting.FogEnd = math.huge
	Lighting.Brightness = 0

	if Terrain then
		Terrain.WaterWaveSize = 0
		Terrain.WaterWaveSpeed = 0
		Terrain.WaterReflectance = 0
		Terrain.WaterTransparency = 1
	end
end

-- Chế độ mạnh (ngay khi vào game)
local function StrongLowPart(v)
	if v:IsA("Decal") or v:IsA("Texture") then
		v.Transparency = 1
	elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
		v.Lifetime = NumberRange.new(0)
	elseif v:IsA("Fire") or v:IsA("SpotLight") or v:IsA("Smoke") or v:IsA("Sparkles") then
		v.Enabled = false
	elseif v:IsA("BlurEffect") or v:IsA("SunRaysEffect") or v:IsA("BloomEffect") or v:IsA("DepthOfFieldEffect") or v:IsA("ColorCorrectionEffect") then
		v.Enabled = false
	elseif v:IsA("MeshPart") or v:IsA("SpecialMesh") then
		v.MeshId, v.TextureID = "", ""
		v.Material, v.Reflectance = Enum.Material.SmoothPlastic, 0
	elseif v:IsA("BasePart") then
		v.Material, v.Reflectance = Enum.Material.SmoothPlastic, 0
	elseif v:IsA("Sound") then
		v.SoundId, v.Volume = "", 0
	elseif v:IsA("Pants") or v:IsA("Shirt") then
		v[v.ClassName.."Template"] = ""
	elseif v:IsA("ShirtGraphic") then
		v.Graphic = ""
	elseif v:IsA("Explosion") then
		v.BlastPressure, v.BlastRadius, v.Visible = 0, 0, false
	elseif v:IsA("ForceField") then
		v.Visible = false
	end
end

-- Chế độ nhẹ (an toàn hơn)
local function SafeLowPart(v)
	if v:IsA("Decal") or v:IsA("Texture") then
		v.Transparency = 1
	elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
		v.Lifetime = NumberRange.new(0)
	elseif v:IsA("Fire") or v:IsA("SpotLight") or v:IsA("Smoke") or v:IsA("Sparkles") then
		v.Enabled = false
	elseif v:IsA("BlurEffect") or v:IsA("SunRaysEffect") or v:IsA("BloomEffect") or v:IsA("DepthOfFieldEffect") or v:IsA("ColorCorrectionEffect") then
		v.Enabled = false
	elseif v:IsA("BasePart") then
		v.Material = Enum.Material.SmoothPlastic
	elseif v:IsA("Sound") then
		v.Volume = 0
	end
end

-- Áp dụng ngay chế độ mạnh khi vào game
BasicSettings()
for _, v in ipairs(game:GetDescendants()) do
	StrongLowPart(v)
end

-- Sau 5 giây, chuyển sang chế độ nhẹ để an toàn
task.delay(5, function()
	game.DescendantAdded:Connect(SafeLowPart)
end)
